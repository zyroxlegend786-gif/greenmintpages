<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GreenPages</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
--bg:#020617;
--card:#0f172a;
--border:#1e293b;
--muted:#94a3b8;
--green:#22c55e;
--blue:#38bdf8;
--red:#ef4444;
}

*{box-sizing:border-box}
body{
margin:0;
font-family:system-ui,-apple-system;
background:linear-gradient(135deg,#021d17,#020617);
color:#e5e7eb;
}

header{
padding:18px 24px;
border-bottom:1px solid var(--border);
display:flex;
justify-content:space-between;
align-items:center;
backdrop-filter:blur(14px);
position:sticky;
top:0;
z-index:10;
background:#020617cc;
}

header b{
font-size:19px;
letter-spacing:.5px;
}

#app{
max-width:1150px;
margin:auto;
padding:30px 20px 80px;
}

.card{
background:linear-gradient(180deg,#0f172a,#0b1220);
border:1px solid var(--border);
border-radius:20px;
padding:20px;
margin-bottom:18px;
box-shadow:0 15px 35px -15px black;
animation:fade .3s ease;
}

@keyframes fade{
from{opacity:0;transform:translateY(6px)}
to{opacity:1}
}

.row{
display:flex;
justify-content:space-between;
align-items:center;
gap:12px;
flex-wrap:wrap;
}

button{
padding:10px 18px;
border:none;
border-radius:12px;
font-weight:600;
cursor:pointer;
transition:.25s;
}

button:hover{
transform:translateY(-2px);
filter:brightness(1.1);
}

.green{background:linear-gradient(135deg,#22c55e,#4ade80);color:#022c22;}
.gray{background:#334155;color:white;}
.red{background:linear-gradient(135deg,#ef4444,#f87171);color:white;}
.blue{background:linear-gradient(135deg,#38bdf8,#60a5fa);color:#021d3a;}

input{
width:100%;
padding:12px;
border-radius:14px;
border:1px solid var(--border);
background:#020617;
color:white;
}

textarea{
width:100%;
height:320px;
background:#020617;
color:#22c55e;
border:1px solid var(--border);
border-radius:16px;
padding:18px;
font-family:monospace;
}

iframe{
width:100%;
height:350px;
border-radius:16px;
border:1px solid var(--border);
background:white;
margin-top:16px;
}

a{color:var(--blue);text-decoration:none}
a:hover{text-decoration:underline}

.plan-badge{
padding:6px 12px;
border-radius:20px;
font-size:12px;
font-weight:700;
}

.free{background:#334155}
.normal{background:#1e3a8a}
.owner{background:#14532d}

</style>
</head>
<body>

<header>
<b>ðŸŒ¿ GreenPages</b>
<div id="auth"></div>
</header>

<div id="app"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>

firebase.initializeApp({
apiKey: "YOUR_KEY",
authDomain: "YOUR_AUTH",
databaseURL: "YOUR_DB",
projectId: "YOUR_PROJECT"
});

const auth=firebase.auth();
const db=firebase.database();
const app=document.getElementById("app");
const authBox=document.getElementById("auth");

let tempCode='<!DOCTYPE html><html><body><h1>Hello GreenPages ðŸŒ¿</h1></body></html>';
let editingId=null;
let userPlan="free";
let expiry=null;

/* AUTH */
auth.onAuthStateChanged(user=>{
const q=new URLSearchParams(location.search);

if(q.get("site")){
db.ref("sites/"+q.get("site")).once("value",s=>{
if(s.exists()){
document.open();
document.write(s.val().html);
document.close();
}
});
return;
}

if(user){
loadPlan();
authBox.innerHTML=`${user.displayName}
<button class="gray" onclick="auth.signOut()">Logout</button>`;
}else{
authBox.innerHTML=`<button class="green" onclick="login()">Login</button>`;
app.innerHTML="<h2>Login to continue ðŸŒ¿</h2>";
}
});

function login(){
auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}

/* PLAN */
function loadPlan(){
db.ref("users/"+auth.currentUser.uid).once("value",s=>{
if(s.exists()){
userPlan=s.val().plan||"free";
expiry=s.val().expiry||null;
}
dashboard();
});
}

function planBadge(){
if(userPlan==="owner") return `<span class="plan-badge owner">OWNER</span>`;
if(userPlan==="normal") return `<span class="plan-badge normal">PRO</span>`;
return `<span class="plan-badge free">FREE</span>`;
}

/* DASHBOARD */
function dashboard(){
editingId=null;

app.innerHTML=`
<div class="card row">
<h2>Dashboard ${planBadge()}</h2>
<div>
<button class="blue" onclick="redeemUI()">Redeem</button>
<button class="green" onclick="newSite()">+ New Site</button>
</div>
</div>
<div id="list"></div>
`;

const list=document.getElementById("list");
let count=0;

db.ref("sites").orderByChild("uid")
.equalTo(auth.currentUser.uid)
.once("value",snap=>{
snap.forEach(s=>{
count++;
const d=s.val();
list.innerHTML+=`
<div class="card row">
<b>${d.name}</b>
<div>
<a href="?site=${s.key}" target="_blank">Open</a>
<button class="gray" onclick="editSite('${s.key}')">Edit</button>
<button class="red" onclick="delSite('${s.key}')">Delete</button>
</div>
</div>
`;
});
});

}

/* LIMIT CHECK */
function canCreate(callback){
db.ref("sites").orderByChild("uid")
.equalTo(auth.currentUser.uid)
.once("value",snap=>{
let total=snap.numChildren();

if(userPlan==="owner") return callback(true);

if(userPlan==="normal"){
if(Date.now()>expiry){
alert("Plan expired");
userPlan="free";
db.ref("users/"+auth.currentUser.uid).set({plan:"free"});
return callback(false);
}
return callback(total<10);
}

return callback(total<2);
});
}

/* REDEEM */
function redeemUI(){
app.innerHTML=`
<div class="card">
<h3>Redeem Code</h3>
<input id="code" placeholder="Enter code"><br><br>
<button class="green" onclick="redeem()">Redeem</button>
<button class="gray" onclick="dashboard()">Back</button>
</div>
`;
}

function redeem(){
const code=document.getElementById("code").value.trim();

if(code==="HAGQ-OWNER"){
db.ref("codes/owner").once("value",s=>{
if(s.exists()){
alert("Owner already used");
}else{
db.ref("codes/owner").set({used:true});
db.ref("users/"+auth.currentUser.uid).set({plan:"owner"});
alert("Owner unlocked ðŸ”¥");
loadPlan();
}
});
return;
}

if(code==="FTYER-LAW785"){
db.ref("codes/normal").once("value",s=>{
let used=s.val()?.count||0;
if(used>=2){
alert("Code fully used");
}else{
db.ref("codes/normal").set({count:used+1});
db.ref("users/"+auth.currentUser.uid).set({
plan:"normal",
expiry:Date.now()+365*24*60*60*1000
});
alert("Pro activated ðŸš€");
loadPlan();
}
});
return;
}

alert("Invalid code");
}

/* IDE */
function newSite(){
canCreate(ok=>{
if(!ok){alert("Plan limit reached");return;}
editingId=null;
openIDE();
});
}

function editSite(id){
db.ref("sites/"+id).once("value",s=>{
editingId=id;
tempCode=s.val().html;
openIDE();
});
}

function openIDE(){
app.innerHTML=`
<div class="card">
<textarea id="code">${tempCode}</textarea><br><br>
<button class="gray" onclick="preview()">Preview</button>
<button class="green" onclick="deployUI()">Deploy</button>
<button class="gray" onclick="dashboard()">Back</button>
</div>
<iframe id="view"></iframe>
`;
preview();
}

function preview(){
tempCode=document.getElementById("code").value;
document.getElementById("view").srcdoc=tempCode;
}

/* DEPLOY */
function deployUI(){
app.innerHTML=`
<div class="card">
<input id="name" placeholder="site-name"><br><br>
<button class="green" onclick="deploy()">Confirm Deploy</button>
<button class="gray" onclick="openIDE()">Back</button>
</div>
`;
}

function deploy(){
const name=document.getElementById("name").value.trim();
if(!name)return alert("Enter name");

const data={
uid:auth.currentUser.uid,
name,
html:tempCode,
time:Date.now()
};

if(editingId){
db.ref("sites/"+editingId).update(data);
}else{
db.ref("sites").push(data);
}

dashboard();
}

function delSite(id){
if(confirm("Delete site?")){
db.ref("sites/"+id).remove();
dashboard();
}
}

</script>
</body>
</html>
