<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GreenPages</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#020617;
  --card:#020617cc;
  --border:#1e293b;
  --green:#22c55e;
  --blue:#38bdf8;
  --red:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:
    radial-gradient(1200px 500px at top,#022c22 0%,transparent 60%),
    var(--bg);
  color:#e5e7eb;
}

header{
  padding:16px 24px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
  backdrop-filter:blur(12px);
  position:sticky;
  top:0;
}

#app{
  max-width:1150px;
  margin:auto;
  padding:26px 20px 80px;
}

.card{
  background:linear-gradient(180deg,#020617ee,#020617aa);
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 20px 40px -20px black;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}

button{
  padding:9px 16px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
button:hover{transform:translateY(-1px)}

.green{background:#22c55e;color:#022c22}
.gray{background:#334155;color:white}
.red{background:#ef4444;color:white}

input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#020617;
  color:white;
}

textarea{
  width:100%;
  height:300px;
  background:#020617;
  color:#22c55e;
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
  font-family:monospace;
}

iframe{
  width:100%;
  height:340px;
  border-radius:16px;
  border:1px solid var(--border);
  background:white;
  margin-top:14px;
}

a{color:#38bdf8;text-decoration:none}
#auth button{margin-left:10px}
</style>
</head>

<body>
<header>
  <b>ðŸŒ¿ GreenPages</b>
  <div id="auth"></div>
</header>

<div id="app"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBJ-Ki5RueLv0_JatYBaoEatlZS4WD9ZMY",
  authDomain: "greenpages-cc200.firebaseapp.com",
  databaseURL: "https://greenpages-cc200-default-rtdb.firebaseio.com",
  projectId: "greenpages-cc200",
  storageBucket: "greenpages-cc200.firebasestorage.app",
  messagingSenderId: "939676595663",
  appId: "1:939676595663:web:39fe97fe23f31bebcd4eba"
});

const auth=firebase.auth();
const db=firebase.database();
const app=document.getElementById("app");
const authBox=document.getElementById("auth");

let tempCode=`<!DOCTYPE html><html><body><h1>Hello GreenPages ðŸŒ¿</h1></body></html>`;
let editingId=null;
let currentView="dashboard";

/* AUTH */
auth.onAuthStateChanged(user=>{
  const q=new URLSearchParams(location.search);

  if(q.get("site")){
    db.ref("sites/"+q.get("site")).once("value",s=>{
      if(s.exists()){
        document.open();
        document.write(s.val().html);
        document.close();
      }else app.innerHTML="<h2>Site not found</h2>";
    });
    return;
  }

  if(user){
    authBox.innerHTML=`${user.displayName}
      <button class="gray" onclick="auth.signOut()">Logout</button>`;
    dashboard();
  }else{
    authBox.innerHTML=`<button class="green" onclick="login()">Login</button>`;
    app.innerHTML=`<h2>Login to use GreenPages ðŸŒ¿</h2>`;
  }
});

function login(){
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}

/* DASHBOARD */
function dashboard(){
  currentView="dashboard";
  editingId=null;
  app.innerHTML=`
    <div class="card row">
      <h2>Dashboard</h2>
      <button class="green" onclick="newSite()">+ New Site</button>
    </div>
    <div id="list"></div>
  `;

  const list=document.getElementById("list");
  list.innerHTML="";

  db.ref("sites").orderByChild("uid")
  .equalTo(auth.currentUser.uid)
  .once("value",snap=>{
    snap.forEach(s=>{
      const d=s.val();
      list.innerHTML+=`
        <div class="card row">
          <b>${d.name}</b>
          <div>
            <a href="?site=${s.key}" target="_blank">Open</a>
            <button class="gray" onclick="editSite('${s.key}')">Edit</button>
            <button class="red" onclick="delSite('${s.key}')">Delete</button>
          </div>
        </div>`;
    });
  });
}

function delSite(id){
  if(confirm("Delete site?")){
    db.ref("sites/"+id).remove();
    dashboard();
  }
}

/* IDE */
function newSite(){
  editingId=null;
  tempCode=`<!DOCTYPE html><html><body><h1>Hello GreenPages ðŸŒ¿</h1></body></html>`;
  openIDE();
}

function editSite(id){
  db.ref("sites/"+id).once("value",s=>{
    editingId=id;
    tempCode=s.val().html;
    openIDE();
  });
}

function openIDE(){
  currentView="ide";
  app.innerHTML=`
    <div class="card">
      <textarea id="code">${tempCode}</textarea><br><br>
      <button class="gray" onclick="preview()">Preview</button>
      <button class="green" onclick="deployUI()">Deploy</button>
      <button class="gray" onclick="dashboard()">Back</button>
    </div>
    <iframe id="view"></iframe>
  `;
  preview();
}

function preview(){
  tempCode=document.getElementById("code").value;
  document.getElementById("view").srcdoc=tempCode;
}

/* DEPLOY UI */
function deployUI(){
  currentView="deploy";
  app.innerHTML=`
    <div class="card">
      <input id="name" placeholder="site-name"><br><br>
      <button class="green" onclick="deploy()">Confirm Deploy</button>
      <button class="gray" onclick="openIDE()">Back</button>
    </div>`;
}

/* DEPLOY (5 LIMIT) */
function deploy(){
  const name=document.getElementById("name").value.trim();
  if(!name) return alert("Enter site name");

  const uid=auth.currentUser.uid;

  if(editingId){
    db.ref("sites/"+editingId).update({
      uid,name,html:tempCode,time:Date.now()
    });
    alert("Updated âœ…");
    return dashboard();
  }

  db.ref("sites").orderByChild("uid")
  .equalTo(uid)
  .once("value",snap=>{
    if(snap.numChildren()>=5){
      alert("âŒ Limit reached: Only 5 sites allowed");
      return;
    }
    db.ref("sites").push({
      uid,name,html:tempCode,time:Date.now()
    });
    alert("Deployed ðŸš€");
    dashboard();
  });
}

/* âŒ¨ï¸ KEYBOARD SUPPORT */
document.addEventListener("keydown",e=>{
  if(!auth.currentUser) return;

  if(e.ctrlKey && e.key==="Enter" && currentView==="ide"){
    e.preventDefault();
    preview();
  }

  if(e.ctrlKey && e.key.toLowerCase()==="s" && currentView==="ide"){
    e.preventDefault();
    preview();
  }

  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==="d" && currentView==="ide"){
    e.preventDefault();
    deployUI();
  }

  if(e.key==="Escape"){
    if(currentView==="deploy") openIDE();
    else if(currentView==="ide") dashboard();
  }
});
</script>
</body>
</html>
